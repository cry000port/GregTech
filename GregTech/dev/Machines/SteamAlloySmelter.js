var Alloy = 
[
[ItemID.carbonPlate, 1, 20, 3, BlockID.reinforcedGlass, 4],
[ItemID.plateAlloy, 1, 20, 3, BlockID.reinforcedGlass, 4],
[ItemID.dustCopper, 3, ItemID.dustTin, 1, ItemID.ingotBronze, 4],
[ItemID.ingotCopper, 3, ItemID.ingotTin, 1, ItemID.ingotBronze, 4],
[ItemID.dustCopper, 3, ItemID.ingotTin, 1, ItemID.ingotBronze, 4],
[ItemID.ingotCopper, 3, ItemID.dustTin, 1, ItemID.ingotBronze, 4],

//nuggets
[ItemID.ingotCopper, 1, ItemID.MoldNuggets, 0, ItemID.nuggetCopper, 9],
[ItemID.ingotRubber, 1, ItemID.MoldNuggets, 0, ItemID.nuggetRubber, 9],
[265, 1, ItemID.MoldNuggets, 0, ItemID.nuggetIron, 9],
[ItemID.ingotLead, 1, ItemID.MoldNuggets, 0, ItemID.nuggetLead, 9],
[266, 1, ItemID.MoldNuggets, 0, ItemID.nuggetGold, 9],
[ItemID.ingotBronze, 1, ItemID.MoldNuggets, 0, ItemID.nuggetBronze, 9],
[ItemID.ingotTin, 1, ItemID.MoldNuggets, 0, ItemID.nuggetTin, 9],
[ItemID.ingotSteel, 1, ItemID.MoldNuggets, 0, ItemID.nuggetSteel, 9],
[ItemID.ingotSilver, 1, ItemID.MoldNuggets, 0, ItemID.nuggetSilver, 9],
[ItemID.ingotAntimony, 1, ItemID.MoldNuggets, 0, ItemID.nuggetAntimony, 9],


//ingots
[ItemID.nuggetAntimony, 9, ItemID.MoldIngot, 0, ItemID.ingotAntimony, 1],
[ItemID.nuggetRubber, 9, ItemID.MoldIngot, 0, ItemID.ingotRubber, 1],
[ItemID.tinydustRubber, 9, ItemID.MoldIngot, 0, ItemID.ingotRubber, 1],
[ItemID.smalldustRubber, 4, ItemID.MoldIngot, 0, ItemID.ingotRubber, 1],
[ItemID.dustRubber, 1, ItemID.MoldIngot, 0, ItemID.ingotRubber, 1],
[ItemID.nuggetBronze, 9, ItemID.MoldIngot, 0, ItemID.ingotBronze, 1],
[ItemID.nuggetTin, 9, ItemID.MoldIngot, 0, ItemID.ingotTin, 1],
[ItemID.nuggetCopper, 9, ItemID.MoldIngot, 0, ItemID.ingotCopper, 1],
[ItemID.nuggetSilver, 9, ItemID.MoldIngot, 0, ItemID.ingotSilver, 1],
[ItemID.nuggetLead, 9, ItemID.MoldIngot, 0, ItemID.ingotLead, 1],
[ItemID.nuggetGold, 9, ItemID.MoldIngot, 0, 266, 1],
[ItemID.nuggetIron, 9, ItemID.MoldIngot, 0, 265, 1],
[ItemID.longrodIron, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.tinydustTin, 9, ItemID.MoldIngot, 0, ItemID.ingotTin, 1],
[ItemID.smalldustTin, 4, ItemID.MoldIngot, 0, ItemID.ingotTin, 1],
[ItemID.smalldustCopper, 4, ItemID.MoldIngot, 0, ItemID.ingotCopper, 1],
[ItemID.tinydustCopper, 9, ItemID.MoldIngot, 0, ItemID.ingotCopper, 1],
[ItemID.tinydustIron, 9, ItemID.MoldIngot, 0, 265, 1],
[ItemID.tinydustLead, 9, ItemID.MoldIngot, 0, ItemID.ingotLead, 1],
[ItemID.smalldustLead, 4, ItemID.MoldIngot, 0, ItemID.ingotLead, 1],
[ItemID.smalldustIron, 4, ItemID.MoldIngot, 0, 265, 1],
[ItemID.tinydustSilver, 9, ItemID.MoldIngot, 0, ItemID.ingotSilver, 1],
[ItemID.smalldustSilver, 4, ItemID.MoldIngot, 0, ItemID.ingotSilver, 1],
[ItemID.plateIron, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.smalldustBronze, 4, ItemID.MoldIngot, 0, ItemID.ingotBronze, 1],
[ItemID.smalldustGold, 4, ItemID.MoldIngot, 0, 266, 1],
[ItemID.tinydustAntimony, 9, ItemID.MoldIngot, 0, ItemID.ingotAntimony, 1],
[ItemID.smalldustAntimony, 4, ItemID.MoldIngot, 0, ItemID.ingotAntimony, 1],
[ItemID.tinydustGold, 9, ItemID.MoldIngot, 0, 266, 1],
[ItemID.tinydustBronze, 9, ItemID.MoldIngot, 0, ItemID.ingotBronze, 1],
[ItemID.dustBronze, 1, ItemID.MoldIngot, 0, ItemID.ingotBronze, 1],
[ItemID.dustRubber, 1, ItemID.MoldIngot, 0, ItemID.ingotRubber, 1],
[ItemID.dustCopper, 1, ItemID.MoldIngot, 0, ItemID.ingotCopper, 1],
[ItemID.dustTin, 1, ItemID.MoldIngot, 0, ItemID.ingotTin, 1],
[ItemID.dustIron, 1, ItemID.MoldIngot, 0, 265, 1],
[ItemID.dustGold, 1, ItemID.MoldIngot, 0, 266, 1],
[ItemID.dustSilver, 1, ItemID.MoldIngot, 0, ItemID.ingotSilver, 1],
[ItemID.dustAntimony, 1, ItemID.MoldIngot, 0, ItemID.ingotAntimony, 1],
[ItemID.dustLead, 1, ItemID.MoldIngot, 0, ItemID.ingotLead, 1],

//plates
[ItemID.ingotRubber, 2, ItemID.MoldPlate, 0, ItemID.plateRubber, 1],
[ItemID.dustRubber, 2, ItemID.MoldPlate, 0, ItemID.plateRubber, 1],
[ItemID.ingotSteel, 2, ItemID.MoldPlate, 0, ItemID.plateSteel, 1],
[265, 2, ItemID.MoldPlate, 0, ItemID.plateIron, 1],
[ItemID.ingotCopper, 2, ItemID.MoldPlate, 0, ItemID.plateCopper, 1],
[ItemID.ingotBronze, 2, ItemID.MoldPlate, 0, ItemID.plateBronze, 1],
[ItemID.ingotSilver, 2, ItemID.MoldPlate, 0, ItemID.plateSilver, 1],
[ItemID.ingotTin, 2, ItemID.MoldPlate, 0, ItemID.plateTin, 1],
[266, 2, ItemID.MoldPlate, 0, ItemID.plateGold, 1],
[ItemID.ingotLead, 2, ItemID.MoldPlate, 0, ItemID.plateLead, 1],
[ItemID.ingotAntimony, 2, ItemID.MoldPlate, 0, ItemID.plateAntimony, 1],


[ItemID.dustSteel, 2, ItemID.MoldPlate, 0, ItemID.plateSteel, 1],
[ItemID.dustIron, 2, ItemID.MoldPlate, 0, ItemID.plateIron, 1],
[ItemID.dustCopper, 2, ItemID.MoldPlate, 0, ItemID.plateCopper, 1],
[ItemID.dustBronze, 2, ItemID.MoldPlate, 0, ItemID.plateBronze, 1],
[ItemID.dustSilver, 2, ItemID.MoldPlate, 0, ItemID.plateSilver, 1],
[ItemID.dustTin, 2, ItemID.MoldPlate, 0, ItemID.plateTin, 1],
[ItemID.dustGold, 2, ItemID.MoldPlate, 0, ItemID.plateGold, 1],
[ItemID.dustLead, 2, ItemID.MoldPlate, 0, ItemID.plateLead, 1],
[ItemID.dustAntimony, 2, ItemID.MoldPlate, 0, ItemID.plateAntimony, 1],

//anvil
[265, 31, ItemID.MoldAnvil, 0, 145, 1],
];

Translation.addTranslation("Steam Alloy Smelter", {ru: "Паровая плавильня",  zh: "蒸汽铸造"});

IDRegistry.genBlockID("SteamAlloySmelter");
Block.createBlockWithRotation("SteamAlloySmelter", [
{name: "Steam Alloy Smelter", texture: [["MACHINE_BRONZEBRICKS_BOTTOM", 0], ["MACHINE_BRONZE", 0], ["MACHINE_BRONZEBRICKS", 0], ["MACHINE_BRONZE_ALLOYSMELTER", 0], ["MACHINE_BRONZEBRICKS", 0], ["MACHINE_BRONZEBRICKS", 0],], inCreative: true}
]);

Callback.addCallback("PostLoaded", function(){
	Recipes.addShaped({id: BlockID.SteamAlloySmelter, count: 1, data: 0}, [
		"bbb",
		"fcf",
		"bbb"
	], ['b', BlockID.SmallBronzeFluidPipe, 0, 'c', BlockID.BrikedBronzeHull, 0, 'f', 61, 0]);
});

var guiSteamAlloySmelter = new UI.StandartWindow({
    standart: {
        header: {text: {text: "Steam Alloy Smelter"}},
        inventory: {standart: true},
        background: { bitmap: "BronzeBG"}
    },
	params: {
         
               slot: "BronzeSlot",
               invSlot: "BronzeSlot"
     

     },

    
    drawing: [
            {type: "bitmap", x: 530, y: 153, bitmap: "BronzeProgressBG", scale: 3.2},
            {type: "bitmap", x: 900, y: 400, bitmap: "GTLogoBronze", scale: 4},     
    ],
	
    
    elements: {
        "slotSource": {type: "slot", x: 381, y: 150, bitmap: "bronzeSlotFire"},
		"slotSource2": {type: "slot", x: 441, y: 150, bitmap: "bronzeSlotFire"},
		"slotResult": {type: "slot", x: 625, y: 150},		
		"progressScale": {type: "scale", x: 530, y: 150, direction: 0, value: 0, bitmap: "BronzeProgressScale", scale: 3.2},
    }
});


SteamMachineRegistry.register(BlockID.SteamAlloySmelter, {
	defaultValues: {
		energy_consumption: 16,
		work_time: 200,
		progress: 0,
		gazLevel: 0
	},
	
	getGuiScreen: function(){
		return guiSteamAlloySmelter;
	},
	
	setDefaultValues: function(){
		this.data.energy_consumption = this.defaultValues.energy_consumption;
		this.data.work_time = this.defaultValues.work_time;
	},
	
	
	tick: function(){
		this.setDefaultValues();
		var content = this.container.getGuiContent();
		var sourceSlot = this.container.getSlot("slotSource");
		var sourceSlot2 = this.container.getSlot("slotSource2");
		var resultSlot = this.container.getSlot("slotResult");
		for (var a in Alloy){			
			if (sourceSlot.id == Alloy[a][0]&& sourceSlot2.id == Alloy[a][2]&& sourceSlot.count >= Alloy[a][1]&& sourceSlot2.count >= Alloy[a][3]&& (resultSlot.id == Alloy[a][4] || 0) && resultSlot.count < 64){
				if(this.data.steam >= this.data.energy_consumption){
					this.data.steam -= this.data.energy_consumption;
					this.data.progress += 1/this.data.work_time;
				}else{
            this.data.progress = 0;
        }
			
				if(this.data.progress >= 1 && this.data.gazLevel == 0){
                    
					sourceSlot.count -= Alloy[a][1];
					sourceSlot2.count -= Alloy[a][3];
					resultSlot.id = Alloy[a][4];
					resultSlot.data = 0;
					resultSlot.count += Alloy[a][5];
					this.container.validateAll();
					this.data.progress = 0;
				}
			}
		}
		this.container.setScale("progressScale", this.data.progress);
	},
					
	getEnergyStorage: function(){
		return 16000;
	},
	energyTick: SteamMachineRegistry.basicEnergyReceiveFunc	
});
